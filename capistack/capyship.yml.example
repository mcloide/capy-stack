# CapiStack Configuration Example
# Place this file in your repository root as capistack.yml

version: 1

# Runner configuration
runner: local  # or docker:image: "python:3.12-slim"

# Environment variables to inject (must exist as secrets in CapiStack)
env:
  - API_KEY
  - DATABASE_URL
  - WEBHOOK_URL

# Build steps (optional)
build:
  - echo "Building application..."
  - make build
  - npm run build
  - python -m pip install -r requirements.txt

# Deploy steps (required)
deploy:
  - echo "Deploying application..."
  - ./deploy.sh --env=$CAPY_REF --ref=$CAPY_REF_NAME
  - # Alternative: direct commands
  - # docker build -t myapp .
  - # docker run -d --name myapp myapp

# Post-deployment steps (optional)
post_deploy:
  - echo "Running post-deployment tasks..."
  - curl -XPOST $WEBHOOK_URL -d "{\"status\":\"$CAPY_STATUS\",\"ref\":\"$CAPY_REF_NAME\"}"
  - # Health check
  - # curl -f http://localhost:8080/health || exit 1
